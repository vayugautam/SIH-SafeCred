%% File: /docs/system-diagram.mmd
flowchart TD
    %% Applicant Journey
    A([Step 1: Beneficiary submits Loan Application<br>(Loan Amount, Tenure, Declared Income, Documents, Bank Statement)])
    
    %% Backend Orchestrator
    B([Step 2: Backend Orchestrator<br>(Collects data, stores files, starts verification pipeline)])
    
    %% Verification Layer
    C([Step 3: Repayment History Analysis<br>(Check past loan repayments from bank statement)])
    D([Step 4: Income Verification<br>(Compare Declared Income vs Bank Statement Inflow)])
    E{Mismatch > 10% ?}
    
    %% Branch 1 - Stable Income
    F1([Stable/Fix Income Earner<br> → Flag for Manual Review<br>(Possible Fraud Risk)])
    
    %% Branch 2 - Informal Income
    F2([Seasonal/Informal Earner<br> → Use Alternative Proxies<br>(Mobile Recharges, Electricity Bills, Utility Payments)])
    
    %% Features for ML
    G([Step 5: Feature Vector Assembly<br>(Repayment Score, Income/Proxy Score, Repeat Borrower Flag)])
    
    %% ML Scoring
    H([Step 6: ML Scoring Service (FastAPI)<br>→ Logistic Regression / LightGBM Model])
    I([Step 7: Composite Credit Score 0–100])
    
    %% Risk Classification
    J{Step 8: Risk Band Classification}
    K1([Score ≥ 80 → Auto-Approve])
    K2([Score 60–79 → Manual Officer Review])
    K3([Score < 60 → Reject])
    
    %% Outputs
    L([Step 9: Officer Dashboard<br>Shows Applicant Details, Score, Explainability])
    M([Step 10: Admin Dashboard<br>Shows Fraud %, High-Risk %, Approvals Distribution])
    N([Step 11: Applicant Notified<br>(Approval / Review / Rejection)])
    
    %% Connections
    A --> B --> C --> D --> E
    E -- No (≤10%) --> G
    E -- Yes --> F1
    E -- Yes --> F2
    F2 --> G
    G --> H --> I --> J
    J --> K1 --> L
    J --> K2 --> L
    J --> K3 --> L
    L --> M
    L --> N
